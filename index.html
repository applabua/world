<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>GOLDEN MILLION — Get In. Be Remembered.</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style>
  :root{ --bg:#fff; --ink:#111; --muted:#6b7280; --line:#e5e7eb; --overlay:rgba(0,0,0,.45); }
  *{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{position:fixed;inset:0 0 auto 0;z-index:20;display:flex;justify-content:center;padding:8px 12px;pointer-events:none}
  .cta{pointer-events:auto;display:inline-flex;align-items:center;gap:10px;background:rgba(255,255,255,.96);border:1px solid var(--line);border-radius:999px;padding:8px 14px;box-shadow:0 4px 20px rgba(0,0,0,.06)}
  .dot{width:10px;height:10px;border-radius:50%;background:radial-gradient(#ffd24d,#e1b526)}
  .cta b{font-weight:800} .cta span{color:var(--muted)}
  #field{position:fixed;inset:0;display:block;cursor:crosshair}
  .overlay{position:fixed;inset:0;background:var(--overlay);display:none;align-items:center;justify-content:center;z-index:50}
  .overlay.on{display:flex}
  .card{width:min(680px,92vw);background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.25);padding:16px;animation:pop .26s ease-out both}
  @keyframes pop{from{transform:scale(.96);opacity:0}to{transform:scale(1);opacity:1}}
  .title{margin:0 0 6px 0;font-weight:800;letter-spacing:.3px}
  .sub{margin:0 0 12px 0;color:var(--muted)}
  .row{display:flex;gap:12px;flex-wrap:wrap}.col{flex:1 1 260px}
  .drop{min-height:140px;border:1px dashed #cfd3da;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#666;padding:10px;text-align:center;background:#fafafa;cursor:pointer}
  .thumb{max-width:100%;max-height:340px;border-radius:12px;border:1px solid var(--line);display:block}
  .input{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:14px}
  .btn{appearance:none;border:1px solid var(--line);background:#fff;color:#111;padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn.primary{border-color:#111;background:#111;color:#fff}
</style>
</head>
<body>
<header>
  <div class="cta"><div class="dot"></div><b>GOLDEN MILLION</b><span>Get in now — be remembered beside legends.</span></div>
</header>

<canvas id="field"></canvas>

<!-- VIEW (occupied) -->
<div class="overlay" id="viewOverlay">
  <div class="card">
    <h3 class="title" id="viewTitle">Legend</h3>
    <p class="sub" id="viewSub">“A short line for history.”</p>
    <img id="viewImg" class="thumb" alt="">
    <div class="actions"><button class="btn" id="viewClose">Close</button></div>
  </div>
</div>

<!-- ADD (free) -->
<div class="overlay" id="addOverlay">
  <div class="card">
    <h3 class="title">Claim your spot — $1 / year (test mode)</h3>
    <p class="sub">Add your image and a short line about yourself. Saved only in your browser for now.</p>
    <div class="row">
      <div class="col">
        <div class="drop" id="drop"><input type="file" id="file" accept="image/*" style="display:none"><span id="dropText">Drop an image here (or click)</span></div>
        <img id="preview" class="thumb" alt="" style="display:none;margin-top:8px">
      </div>
      <div class="col">
        <label class="sub" for="desc">Your short line (max 80 chars)</label>
        <input class="input" id="desc" maxlength="80" placeholder="I was here. 2025.">
      </div>
    </div>
    <div class="actions"><button class="btn" id="addCancel">Cancel</button><button class="btn primary" id="addSave">Save (test)</button></div>
  </div>
</div>

<script>
/* ===== World/grid ===== */
const CAN = document.getElementById('field');
const CTX = CAN.getContext('2d', { alpha:false });
let DPR = Math.max(1, window.devicePixelRatio || 1);

const GRID = { cols:1000, rows:1000, size:12 }; // 1,000,000 slots
const WORLD = { w: GRID.cols*GRID.size, h: GRID.rows*GRID.size };
let W=0,H=0, scale=0.3, offX=0, offY=0;

function fit(){
  W = CAN.width = Math.floor(window.innerWidth * DPR);
  H = CAN.height = Math.floor(window.innerHeight * DPR);
  CAN.style.width = window.innerWidth+'px'; CAN.style.height = window.innerHeight+'px';
  const sFit = Math.min(W/WORLD.w, H/WORLD.h);
  if (!fit._done){ scale = Math.min(3, Math.max(0.08, sFit*5)); offX = (W - WORLD.w*scale)/2; offY = (H - WORLD.h*scale)/2; fit._done = true; }
  draw();
}
window.addEventListener('resize', fit);

/* ===== Seeded chaotic cell shape (for photos) ===== */
function seededRand(seed){ let x = seed|0; x^=x<<13; x^=x>>>17; x^=x<<5; return (x>>>0)/4294967296; }
function beginCellPath(x,y,s){ // irregular quad inside the square
  const id = y*GRID.cols + x, j = s*0.18;
  const r1=seededRand(id+1), r2=seededRand(id+2), r3=seededRand(id+3), r4=seededRand(id+4);
  const p = [
    [0 + r1*j, 0 + (1-r2)*j],
    [s - (1-r2)*j, 0 + r3*j],
    [s - r3*j, s - (1-r4)*j],
    [0 + (1-r4)*j, s - r1*j]
  ];
  CTX.beginPath(); CTX.moveTo(p[0][0], p[0][1]);
  for(let i=1;i<4;i++) CTX.lineTo(p[i][0], p[i][1]);
  CTX.closePath();
}

function worldToScreen(wx,wy){ return [(wx*scale + offX), (wy*scale + offY)]; }
function screenToWorld(sx,sy){ return [(sx - offX)/scale, (sy - offY)/scale]; }
function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }

/* ===== Legends (100) ===== */
const LEGEND_NAMES = [
  "Abraham Lincoln","Nelson Mandela","Mahatma Gandhi","Martin Luther King Jr.","Winston Churchill",
  "Volodymyr Zelenskyy","George Washington","Napoleon Bonaparte","Julius Caesar","Cleopatra",
  "Leonardo da Vinci","Michelangelo","Vincent van Gogh","Pablo Picasso","Frida Kahlo",
  "Albert Einstein","Isaac Newton","Galileo Galilei","Nikola Tesla","Marie Curie",
  "Ada Lovelace","Alan Turing","Grace Hopper","Katherine Johnson","Hedy Lamarr",
  "Charles Darwin","Carl Sagan","Richard Feynman","Johannes Kepler","Niels Bohr",
  "William Shakespeare","Homer","Dante Alighieri","Johann S. Bach","Ludwig van Beethoven",
  "Wolfgang A. Mozart","Leo Tolstoy","Fyodor Dostoevsky","Ernest Hemingway","Agatha Christie",
  "Elon Musk","Steve Jobs","Bill Gates","Jeff Bezos","Warren Buffett",
  "Donald Trump","Barack Obama","Joe Biden","Angela Merkel","Emmanuel Macron",
  "Serena Williams","Michael Jordan","Kobe Bryant","Lionel Messi","Cristiano Ronaldo",
  "Pelé","Usain Bolt","Bruce Lee","Jackie Chan","Hayao Miyazaki",
  "Akira Kurosawa","Steven Spielberg","George Lucas","Quentin Tarantino","James Cameron",
  "Mother Teresa","Florence Nightingale","Yayoi Kusama","Banksy","Salvador Dalí",
  "Socrates","Plato","Aristotle","Confucius","Sun Tzu",
  "Genghis Khan","Alexander the Great","Queen Elizabeth II","Joan of Arc","Catherine the Great",
  "Sheryl Sandberg","Satya Nadella","Sundar Pichai","Tim Cook","Susan Wojcicki",
  "Desmond Tutu","Aung San Suu Kyi","Lech Wałęsa","Václav Havel","Stephen Hawking",
  "Jane Goodall","Neil Armstrong","Yuri Gagarin","Amelia Earhart","J.R.R. Tolkien",
  "George R. R. Martin","J.K. Rowling","Haruki Murakami","Gabriel García Márquez","Oprah Winfrey"
];

function svgPortrait(name){
  const initials = name.split(/\s+/).map(w=>w[0]).slice(0,2).join('').toUpperCase();
  const esc = s=>encodeURIComponent(s);
  const svg =
`<svg xmlns='http://www.w3.org/2000/svg' width='600' height='600'>
  <defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'>
    <stop offset='0%' stop-color='#f9e9a3'/><stop offset='50%' stop-color='#f0d16a'/><stop offset='100%' stop-color='#cda434'/>
  </linearGradient></defs>
  <rect width='100%' height='100%' fill='url(#g)'/>
  <circle cx='300' cy='250' r='140' fill='rgba(255,255,255,.25)'/>
  <text x='300' y='285' font-family='system-ui,Arial' font-size='120' text-anchor='middle' fill='#222' font-weight='800'>${initials}</text>
  <text x='300' y='520' font-family='system-ui,Arial' font-size='34' text-anchor='middle' fill='#222' font-weight='700'>${name.replace(/&/g,"&amp;")}</text>
</svg>`;
  return "data:image/svg+xml;utf8,"+esc(svg);
}

const legendMap = new Map();
(function placeLegends(){
  const taken = new Set(); let placed=0, tries=0; const pad=20;
  while (placed < LEGEND_NAMES.length && tries < 50000){
    tries++;
    const x = Math.floor(Math.random()*GRID.cols);
    const y = Math.floor(Math.random()*GRID.rows);
    const key = x+"_"+y; // <-- FIXED (не "x+"_"+y")
    if (taken.has(key)) continue;
    // keep distance
    let ok = true;
    for (let dy=-pad; dy<=pad; dy+=pad){
      for (let dx=-pad; dx<=pad; dx+=pad){
        const k2 = (x+dx)+"_"+(y+dy);
        if (taken.has(k2)) { ok=false; break; }
      } if (!ok) break;
    }
    if (!ok) continue;
    const name = LEGEND_NAMES[placed];
    legendMap.set(key, { name, img: svgPortrait(name), desc: "Part of the Golden Million." });
    taken.add(key); placed++;
  }
})();

/* ===== Local claims (demo) ===== */
const LS_KEY = "golden_million_claims_v2";
let claims = {}; try{ claims = JSON.parse(localStorage.getItem(LS_KEY)||"{}"); }catch(e){ claims = {}; }

/* ===== Drawing ===== */
function draw(){
  CTX.setTransform(1,0,0,1,0,0); CTX.fillStyle="#fff"; CTX.fillRect(0,0,W,H);

  const [wx0, wy0] = screenToWorld(0,0);
  const [wx1, wy1] = screenToWorld(W,H);
  const cx0 = clamp(Math.floor(wx0/GRID.size)-2,0,GRID.cols-1);
  const cy0 = clamp(Math.floor(wy0/GRID.size)-2,0,GRID.rows-1);
  const cx1 = clamp(Math.floor(wx1/GRID.size)+2,0,GRID.cols-1);
  const cy1 = clamp(Math.floor(wy1/GRID.size)+2,0,GRID.rows-1);

  // base grid (visible всегда, лёгкая)
  CTX.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--line').trim() || '#e5e7eb';
  CTX.lineWidth = Math.max(1, 0.5*DPR);
  CTX.beginPath();
  for (let y=cy0; y<=cy1; y++){
    const [sx0, sy] = worldToScreen(cx0*GRID.size, y*GRID.size);
    const [sx1, ]  = worldToScreen((cx1+1)*GRID.size, y*GRID.size);
    CTX.moveTo(sx0, sy); CTX.lineTo(sx1, sy);
  }
  for (let x=cx0; x<=cx1; x++){
    const [sx, sy0] = worldToScreen(x*GRID.size, cy0*GRID.size);
    const [, sy1]   = worldToScreen(x*GRID.size, (cy1+1)*GRID.size);
    CTX.moveTo(sx, sy0); CTX.lineTo(sx, sy1);
  }
  CTX.stroke();

  const sPix = scale*GRID.size;

  // draw images in chaotic masks (when достаточно крупно)
  if (sPix > 12){
    for (let y=cy0; y<=cy1; y++){
      for (let x=cx0; x<=cx1; x++){
        const key = x+"_"+y;
        const rec = claims[key] || legendMap.get(key);
        if (!rec) continue;
        const [sx, sy] = worldToScreen(x*GRID.size, y*GRID.size);
        CTX.save(); CTX.translate(sx, sy); CTX.scale(scale, scale);
        beginCellPath(x,y,GRID.size); CTX.clip();
        drawThumb(rec.img, 0,0, GRID.size, GRID.size);
        CTX.restore();
      }
    }
  }

  // chaotic outlines (только на большом зуме, чтобы не грузить)
  if (sPix > 20){
    CTX.lineWidth = Math.max(1, 0.7*DPR);
    CTX.strokeStyle = '#d0d4dc';
    for (let y=cy0; y<=cy1; y++){
      for (let x=cx0; x<=cx1; x++){
        const [sx, sy] = worldToScreen(x*GRID.size, y*GRID.size);
        CTX.save(); CTX.translate(sx, sy); CTX.scale(scale, scale);
        beginCellPath(x,y,GRID.size); CTX.stroke();
        CTX.restore();
      }
    }
  }
}

const imgCache = new Map();
function loadImg(src){
  if (imgCache.has(src)) return imgCache.get(src);
  const p = new Promise((res,rej)=>{ const im=new Image(); im.crossOrigin="anonymous"; im.onload=()=>res(im); im.onerror=rej; im.src=src; });
  imgCache.set(src,p); return p;
}
async function drawThumb(src, x,y,w,h){
  try{
    const im = await loadImg(src);
    const r = Math.max(w/im.width, h/im.height);
    const iw = im.width*r, ih = im.height*r;
    const ix = x + (w - iw)/2, iy = y + (h - ih)/2;
    CTX.fillStyle="#fff"; CTX.fillRect(x,y,w,h);
    CTX.drawImage(im, ix, iy, iw, ih);
  }catch(e){}
}

/* ===== Interactions ===== */
let dragging=false, sx=0, sy=0, ox=0, oy=0;
CAN.addEventListener('mousedown',e=>{ dragging=true; sx=e.clientX; sy=e.clientY; ox=offX; oy=offY; });
window.addEventListener('mouseup',()=> dragging=false);
window.addEventListener('mousemove',e=>{ if(dragging){ offX = ox + (e.clientX - sx)*DPR; offY = oy + (e.clientY - sy)*DPR; draw(); }});
CAN.addEventListener('wheel',e=>{
  e.preventDefault();
  const delta = Math.sign(e.deltaY)*-0.08;
  const old = scale;
  const rect = CAN.getBoundingClientRect();
  const cx = (e.clientX-rect.left)*DPR, cy=(e.clientY-rect.top)*DPR;
  const [wx,wy] = screenToWorld(cx,cy);
  scale = clamp(scale+delta, 0.08, 3);
  offX = cx - wx*scale; offY = cy - wy*scale;
  draw();
},{passive:false});

CAN.addEventListener('click', (e)=>{
  const rect = CAN.getBoundingClientRect();
  const [wx, wy] = screenToWorld((e.clientX-rect.left)*DPR,(e.clientY-rect.top)*DPR);
  const x = clamp(Math.floor(wx/GRID.size),0,GRID.cols-1);
  const y = clamp(Math.floor(wy/GRID.size),0,GRID.rows-1);
  openCell(x,y);
});

/* ===== Modals ===== */
const viewOverlay = document.getElementById('viewOverlay');
const viewImg = document.getElementById('viewImg');
const viewTitle = document.getElementById('viewTitle');
const viewSub = document.getElementById('viewSub');
document.getElementById('viewClose').onclick = ()=> viewOverlay.classList.remove('on');
viewOverlay.addEventListener('click',e=>{ if(e.target===viewOverlay) viewOverlay.classList.remove('on'); });

const addOverlay = document.getElementById('addOverlay');
const addCancel = document.getElementById('addCancel');
const addSave = document.getElementById('addSave');
const drop = document.getElementById('drop');
const file = document.getElementById('file');
const preview = document.getElementById('preview');
const dropText = document.getElementById('dropText');
const desc = document.getElementById('desc');

function openCell(x,y){
  const key = x+"_"+y;
  if (claims[key] || legendMap.get(key)){
    const rec = claims[key] || legendMap.get(key);
    viewTitle.textContent = rec.name || "Member of the Golden Million";
    viewSub.textContent = rec.desc || "“A short line for history.”";
    viewImg.src = rec.img; viewOverlay.classList.add('on');
  } else {
    preview.style.display='none'; preview.src=''; dropText.textContent="Drop an image here (or click)"; desc.value="";
    addOverlay.dataset.key = key; addOverlay.classList.add('on');
  }
}
addCancel.onclick = ()=> addOverlay.classList.remove('on');
addOverlay.addEventListener('click',e=>{ if(e.target===addOverlay) addOverlay.classList.remove('on'); });
drop.addEventListener('click',()=> file.click());
drop.addEventListener('dragover',e=>{ e.preventDefault(); drop.style.borderColor="#999"; });
drop.addEventListener('dragleave',()=>{ drop.style.borderColor="#cfd3da"; });
drop.addEventListener('drop',e=>{
  e.preventDefault(); drop.style.borderColor="#cfd3da";
  if (e.dataTransfer.files && e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
});
file.addEventListener('change',e=>{ if (e.target.files && e.target.files[0]) handleFile(e.target.files[0]); });
function handleFile(f){
  if(!/^image\//.test(f.type)) return alert("Please choose an image");
  const r=new FileReader(); r.onload=()=>{ preview.src=r.result; preview.style.display='block'; dropText.textContent="Image selected"; }; r.readAsDataURL(f);
}
addSave.onclick = ()=>{
  if (!preview.src) return alert("Please add an image first.");
  const text = (desc.value||"I was here.").slice(0,80);
  const key = addOverlay.dataset.key;
  claims[key] = { img: preview.src, name: "Golden Million Member", desc: text };
  try{ localStorage.setItem(LS_KEY, JSON.stringify(claims)); }catch(e){}
  addOverlay.classList.remove('on'); draw();
};

/* ===== Go ===== */
function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); } // (redeclared below uses this)
fit(); draw();
</script>
</body>
</html>
